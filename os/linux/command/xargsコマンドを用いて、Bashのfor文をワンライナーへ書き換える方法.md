# [xargsコマンドを用いて、Bashのfor文をワンライナーへ書き換える方法 2018/5/23](https://qiita.com/SUZUKI_Masaya/items/a58523c4e4c8b3a2958c)

# 改行区切りのリストを処理する場合
## 基本的な書き換え
以下のような処理があったとします。<br>
```
for f in `ls`
do
   echo "Output:" ${f}
done
```

これを`xargs`コマンドを用いて書き換えると、以下のようになります。<br>
```
ls | xargs -r -L 1 echo "Output:"
```

ここで、`-L`オプションはリストが改行区切りであるという前提の元、コマンドに展開する引数の個数の最大値を指定しています。<br>
* `-L` は、 xarg引数コマンド に一度に展開されるデータの最大値を指定します。<br>
* 標準出力から渡されたデータ数が、 `-L` で指定された数よりお大きい場合、全てのデータが展開し終わるまで xargs引数コマンド が繰り返し実行されます。<br>

さらに、`-r`オプションを指定することで、リストが空の場合にコマンドを実行しないようにしています。<br>

## 引数を任意の位置に展開する場合この場合
### 展開する引数が1個の場合
以下のように記述することで、引数を任意の位置に展開することができます。<br>

```
ls | xargs -r -I @ echo "Output:" @
```
ここで、`-I`オプションは引数を表す文字列を指定しており、このオプションが指定された場合、自動的に`-L` 1も指定されたことになります。<br>

### 展開する引数が2個以上の場合や展開する引数内で変数内置換を用いる場合
以下のように記述することで、引数を任意の位置に展開することができます。<br>

```
ls | xargs -r -L 2 bash -c 'echo "Output:" ${0} ${1}'
```
この場合、`${0}`, `${1}` (`${0}`～`${引数の個数の最大値-1}`) は引数の位置を表しており、`bash`コマンドを間に挟んでコマンドを実行しています。<br>

# 改行区切りではないリストを処理する場合
## 基本的な書き換え
以下のような処理があったとします。<br>
```
for s in "aaa" "iii"
do
   echo "Output:" ${s}
done
```
これを`xargs`コマンドを用いて書き換えると、以下のようになります。<br>

```
echo "aaa" "iii" | xargs -r -n 1 echo "Output:"
```

ここで、`-n`オプションはリストが**改行区切りではない**という前提の元、コマンドに展開する引数の個数の最大値を指定しています。<br>
さらに、`-r`オプションを指定することで、リストが空の場合にコマンドを実行しないようにしています。<br>

## 引数を任意の位置に展開する場合

以下のように記述することで、引数を任意の位置に展開することができます。<br>
```
echo "aaa" "iii" "uuu" "eee" | xargs -r -n 2 bash -c 'echo "Output:" ${0} ${1}'
```
この場合、`${0}`, `${1}` (`${0}`～`${引数の個数の最大値-1}`) は引数の位置を表しており、`bash`コマンドを間に挟んでコマンドを実行しています。<br>

## 並列化
以下のように`xargs`コマンドを用いると、for文で記述した場合には不可能であった並列化が可能になります。<br>
```
echo "aaa" "iii" | xargs -r -n 1 -P 2 echo "Output:"
```
ここで、`-P`オプションはプロセス数の最大値を指定しています。<br>

# 参考文献
* [xargs を使ってカジュアルに並列処理 - たごもりすメモ](https://tagomoris.hatenablog.com/entry/20110513/1305267021)
* [xargs のオプションいろいろ - Qiita](https://qiita.com/hitode7456/items/6ba8e2d58f9b8db9de11)
* [【 xargs 】コマンド――コマンドラインを作成して実行する：Linux基本コマンドTips（176） - ＠IT](http://www.atmarkit.co.jp/ait/articles/1801/19/news014.html)
* [xargsコマンドで覚えておきたい使い方・組み合わせ7個(+1個) | 俺的備忘録 ～なんかいろいろ～](https://orebibou.com/2015/07/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AA%E3%82%89%E8%A6%9A%E3%81%88%E3%81%A6%E3%81%8A%E3%81%8D%E3%81%9F%E3%81%84%E3%80%8Exargs%E3%80%8F/#8)
* [bash 拡張的な変数展開に失敗します。 - 1 は成功するのに 2 が失敗するのは... - Yahoo!知恵袋](https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1227556757)
