## [試して覚えるPacemaker入門 『リソース設定編』](https://www.slideshare.net/ssuser5e5dc9/pacemaker-69943002)

```
1. 試して覚えるPacemaker入門 『 リソース設定編 』 ～ Pacemakerでノードやサービスを手玉に取ろう！ ～ 2016年 11月 19日 OSC2016 Fukuoka Linux-HA Japan 松浦 健太
2. 目次  Pacemakerってなに？  Pacemakerの設定とは？  Pacemakerのリソース設定  リソース定義・パラメータ設定  リソース種類選択  リソース制約  クラスタ設定  さいごに  Linux-HA Japanの紹介 Linux-HA Japan Project 2
3. Pacemakerってなに？ 3 Pacemakerはオープンソースの HAクラスタソフトです Linux-HA Japan Project
4. Pacemakerってなに？ 4 High Availability = 高可用性 つまり 一台のコンピュータでは得られない高い信頼 性を得るために、 複数のコンピュータを結合(クラスタ化)し、 ひとまとまりとする… サービス継続性 ためのソフトウェアです Linux-HA Japan Project
5. Pacemakerってなに？ 5 現用系 待機系 サービス HAクラスタソフトを導入すると、 故障で現用系でサービスが運用できなくなったときに、 自動的に待機系でサービスを起動させます →このことを「フェイルオーバ」と言います サービス 故障 フェイルオーバ Linux-HA Japan Project
6. Pacemakerってなに？ 6 は このHAクラスタソフトとして 実績のある「Heartbeat」と 呼ばれていたソフトの後継です Linux-HA Japan Project
7. Pacemakerってなに？ 7 サーバ#1 サーバ#2 アプリケーション監視・制御 仮想IP 自己監視 ノード監視 ディスク監視・制御 ネットワーク監視・制御 ・プロセス監視 ・watchdog ・ファイルシステム監視 ・共有ディスク排他制御 ・ハートビート通信 ・STONITH(強制電源断) ・ping疎通確認 ・仮想IP制御 ・起動・停止・稼働監視 Pacemakerで監視できること Linux-HA Japan Project
8. サーバ#2サーバ#1 Pacemakerってなに？ Linux-HA Japan Project 8  Pacemakerはアプリケーションやディスク、ネットワーク等をリソースと呼 び、このリソースを起動/停止/監視することで管理します。  リソースの例：Apache、PostgreSQL、共有ディスク、仮想IPアドレス… http://*******.html 仮想IP ・ping疎通確認 ・ディスク読込確認 ・起動管理 ・ディスク読込確認 ・ping疎通確認 サーバ#2 Disk監視 Network 監視 Webサーバ 排他管理 仮想IP Pacemaker リソース制御 Disk監視 Network 監視 サーバ#1 Pacemaker リソース制御 Pacemakerの リソース制御 リソース
9. Pacemakerってなに？ Q. リソース毎に制御方法は違うのにPacemakerは正しく管理できるの？？？ A. リソースの制御はリソースエージェント(RA)を介して行います。  RAが各リソースの操作方法の違いをラップし、Pacemakerで制御できるよ うにしている  多くは起動・停止・監視等を行う関数が実装されたシェルスクリプト PostgreSQL RA Apache RA 共有ディスク RA リソース リソース エージェント 9Linux-HA Japan Project
10. Linux-HA Japan Project 10 Pacemakerのリソース設定
11. Pacemakerの設定とは？ Linux-HA Japan Project 11  Pacemakerには主に2つの設定ファイルがあります。  クラスタ通信設定： クラスタを組むノードの指定やクラスタ間の通信方法の設定  リソース設定： クラスタ上でPacemakerが管理するリソースの管理方法を設定 サーバ#1 サーバ#2 Pacemaker クラスタ間の通信 Disk監視 Network監視 Webサーバ 排他管理 仮想IP Pacemaker Disk監視 Network監視 本資料では『リソース設定』について説明します。 クラスタ通信 設定 リソース制御 リソース制御 リソース設定
12. リソース設定の流れ Linux-HA Japan Project 12 Pacemakerのリソース定義用Excelテン プレートシートにリソース構成を入力 ExcelのシートをCSVファイルで保存 ([名前を付けて保存]からCSV形式を選択) Windows端末 Pacemakerのツールコマンドを使用して CRMファイルに変換 Pacemakerのツールコマンドを使用して CRMファイルをPacemakerにロード Linux端末 ファイル転送 Linux-HA Japanの Pacemaker独自実装 # pm_crmgen -o CRMファイル名 CSVファイル名 # crm configure load update CRMファイル名
13. なんでこんな設定に手順必要なの？ Linux-HA Japan Project 13  Pacemakerのリソース設定ファイルはCRMファイルのみであり、CRMファイルを記述で きればExcelで設定する必要がありません。 え、これ自分で入力するの？？？（汗） そんな人のために、Excelで簡単に 入力できるテンプレートシートと、 そこからCRMファイルに変換する ツールが作られたの。 でかした～！！ （CRMファイル記入例） ### Cluster Option ### property no-quorum-policy="ignore" ¥ stonith-enabled="true" ¥ startup-fencing="false“ ### Resource Defaults ### rsc_defaults resource-stickiness="200" ¥ migration-threshold="1“ ### Group Configuration ### group grpPostgreSQL ¥ prmFilesystem ¥ prmVip ¥ prmPostgreSQL ### Clone Configuration ### clone clnPing ¥ prmPing clone clnDiskd1 ¥ prmDiskd1 clone clnDiskd2 ¥ prmDiskd2 ### Group Configuration ### group grpStonith1 ¥ prmStonith1-1 ¥ prmStonith1-2 group grpStonith2 ¥ prmStonith2-1 ¥ prmStonith2-2 ・・・・・・
14. リソース設定用テンプレートシート Linux-HA Japan Project 14  ExcelテンプレートシートはPacemakerインストール時に以下に配置されます。  /usr/share/pacemaker/pm_crmgen/pm_crmgen_env.xls  基本的にはこのテンプレートシートをWindowsマシンに転送して設定します。 # pm_crmgen 環境定義書 ファイル形式バージョン: 2.1 #表 1-1 クラスタ設定　…　クラスタ・ノード属性 NODE ntype # ノード種別 #表 2-1 クラスタ設定　…　クラスタ・プロパティ PROPERTY # #表 3-1 クラスタ設定　…　リソース・デフォルト RSC_DEFAULTS name value stonith-enabled 障害ノード対処（STONITH制御） startup-fencing 起動時に状態不明ノードへSTONITH 項目 設定内容 概要 no-quorum-policy ノード数によるリソース割当て name value uname ptype name value ノード名 パラメータ種別 項目 設定内容 pm_crmgen.xls
15. 何を設定するの？ Linux-HA Japan Project 15 リソース設定では主に以下の4つを設定します。 リソース定義・パラメータ設定 リソース種類選択 リソース制約 クラスタ設定 Apache RA リソースID 起動パラ メータ Apache リソース リソースAリソースAリソースA (同一リソース をクラスタ内に 複数起動) リソースB リソースC (複数のリソー スを一括管理) リソースA リソースB  リソースが起動 するノードを制御  リソースの起動 順序を制御 起動順 起動パラ メータ 起動パラ メータ 故障 抑止 (スプリットブレイン時の排他制御)
16. Linux-HA Japan Project 16 Pacemakerのリソース設定 1. リソース定義・パラメータ設定 2. リソース種類選択 3. リソース制約 4. クラスタ設定
17. リソース定義・パラメータ設定(1/3) Linux-HA Japan Project 17  ここではリソースを1つずつ定義し、また起動に必要なパラメータの設定等も行います。  設定する内容は以下の通りです。  リソースID (リソース毎にユニークなIDを設定します)  リソースが使用するRA  パラメータ(リソースの起動に必要な設定。パラメータ項目はRAによって異なります)  動作設定(起動・監視・停止処理のタイムアウトや失敗時の自動対処を設定します) サーバ#1 サーバ#2 Pacemaker Disk監視 Network監視 Webサーバ 排他管理 仮想IP Pacemaker Disk監視 Network監視 リソース制御 リソース制御 これらのリソース を1つずつ定義し ます。
18. リソース定義・パラメータ設定(2/3) Linux-HA Japan Project 18  リソース定義はExcelテンプレートシート 表7-1に設定します。  複数リソース設定する場合は表7-1をコピーして表を作成し、設定します。 #表 7-1 クラスタ設定　…　Primitiveリソース PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop 60s 0s block 60s 0s restart 60s 10s restart タイムアウト値 監視間隔 障害時の動作 起動前待機時間 備考 timeout interval on-fail start-delay configfile /etc/httpd/conf/httpd.conf name value 項目 設定内容 概要 概要 prmApache id class provider type リソースID class provider type ocf heartbeat apache リソースが使用するRA 設定例： /usr/lib/ocf/resource.d/heartbeat/apache リソースID パラメータ 動作設定 それぞれの処理の実行が失敗 した際の挙動を設定します。 ・ restart : リソースを再起動 ・ block : 保守者の対応待ち
19. リソース定義・パラメータ設定(3/3) Linux-HA Japan Project 19  リソースの共通デフォルト設定はExcelテンプレートシート 表3-1に設定します。  主に設定する共通設定項目は以下の2点です。 #表 3-1 クラスタ設定　…　リソース・デフォルト RSC_DEFAULTS # name value migration-threshold 1 リソース故障可能回数 何回監視に失敗したらフェイルオーバする か設定します。 項目 設定内容 概要 備考 resource-stickiness INFINITY リソース割当て 基本的には「INFINITY」推奨です。 resource-stickiness (フェイルバックの有無) migration-threshold (同一ノード上でのリソース故障許容数) 現用系 待機系 サービス サービス 故障 フェイルオーバ サービス サービス 復旧！ フェイルバック 自動フェイルバックを有効にする場合は0、 無効の場合はINFINITYを設定 リソース 故障 許容数まで再起動 リソース リソースフェイルオーバ 許容数超えたら フェイルオーバ 故障復旧 許容数オーバ
20. Linux-HA Japan Project 20 Pacemakerのリソース設定 1. リソース定義・パラメータ設定 2. リソース種類選択 3. リソース制約 4. クラスタ設定
21. リソース種類選択(1/3) Linux-HA Japan Project 21 リソースは以下の4種類から選択できます。  プリミティブリソース  クラスタ内で単独起動する。  基本となるリソース種類。  リソースグループ  複数のプリミティブリソースを一括管理 し、1つのリソースの様に動作する。  同一ノード内での起動、および起動順 序を保証する。  クローンリソース  同一リソースを複数のノード上で起動 する。  マスタ/スレーブリソース  複数ノード上にマスタとなるリソースと スレーブとなるリソースを起動する。
22. リソース種類選択(2/3) Linux-HA Japan Project 22  リソース種類の利用例。 サーバ#1 サーバ#2 Pacemaker Disk監視 Network監視 ② Webサーバ ① 排他管理 ③ 仮想IP Pacemaker Disk監視 Network監視 リソース制御 リソース制御 リソースグループサービス提供には以下を現用機 で実行する必要があります。 ① 他ノードでサービスが起動し ていないか確認。 ② Webサーバ起動 ③ ユーザが現用機にアクセス するためのIP割当 上記を同一ノードで一括管理す るため、リソースグループとして 定義します。 ディスク監視、ネットワーク監視は現用機だけでなく、予備機でも実施し、 フェイルオーバ先として問題ないか確認する必要があります。 そのため監視リソースをクローンリソースとして定義し、複数ノード上で起動 する様にします。 クローンリソース
23. リソース種類選択(3/3) Linux-HA Japan Project 23  リソースの種類はExcelテンプレートシート 表4-1に設定します。  リソース構成要素には以下を設定できます。  Primitive : プリミティブリソースを定義、もしくは他リソースに紐付ける際に指定。  Group : リソースグループを定義する際に指定。  紐付けるプリミティブリソースの定義した順がリソースの起動順序となる。  Clone : クローンリソースを定義する際に指定。  Master : マスタ/スレーブリソースを定義する際に指定。  リソースIDには以下を設定します。  Primitive行 : 表7で定義したリソースのリソースID  Group、Clone、Master行 : 任意のユニークなリソースID #表 4-1 クラスタ設定　…　リソース構成 RESOURCES resourceItem resourceItem resourceItem # 概要 Group Primitive Primitive Primitive Clone Primitive Clone Primitive clnPing prmApache prmVIP grpApache prmVipCheck id リソース構成要素 リソースID 備考 prmPing clnDiskd prmDiskd Group、Clone、Masterの場合は ユニークなリソースID名を定義 起 動 順 序 リソース種類 を指定 Group、Clone、Masterを定義する際は先に表7のリソース をPrimitiveとして定義し、それを紐づけている
24. Linux-HA Japan Project 24 Pacemakerのリソース設定 1. リソース定義・パラメータ設定 2. リソース種類選択 3. リソース制約 4. クラスタ設定
25. リソース制約とは 25  リソース制約では各リソースが起動するノードや順序のルールを設定します。  リソース種類設定だけでは実現できない細かい動作をここで設定できます。  制約は主に以下の3種類あります。 リソース配置制約 (LOCATION) リソースA リソースB 属性α if(属性α == hoge)リソースBを起動 リソース同居制約 (COLOCATION) リソース起動順序制約 (ORDER) リソースA リソースB リソースC 起動順 停止順 リソースA リソースB リソースAとリソースBを同居 リソースが起動するノードを 決める設定 リソースが起動する順番を 決める設定
26. リソース配置制約(1/2) Linux-HA Japan Project 26 属性等の情報を元にリソースが起動するノードを決めるルールを設定できます。 ★リソース配置制約を書く上でよく使われる2つの属性  diskd RAとping RAのリソースが管理する属性  diskd RAはディスク、ping RAはネットワークを監視するためのRAです。  監視結果はそれぞれ属性に格納され、他リソースはその値を元にリソース配置 制約で起動・停止します。 diskd リソース ①ディスク監視(問題無し) 属性 ②"normal"を格納 ③リソース配置制約 if(属性==normal) Apache起動 Apache (起動) diskd リソース ①ディスク監視(問題有り) 属性 ②"ERROR"を格納 Apache (停止) ③リソース配置制約 if(属性==ERROR) Apache停止 故障 (diskd RAのリソースの場合) ディスク 故障 属性とは 属性とは、Pacemaker内部で扱われているkey-value型の変数です。 主にRAがリソース管理に必要な情報を各ノード毎にリアルタイムで属性に格納・更新します。
27. リソース配置制約(2/2) Linux-HA Japan Project 27  リソース配置制約はExcelテンプレートシート 表8-1 に設定します。  リソース配置制約を含むリソース制約は、各ノード毎にリソース配置の優先度で あるスコアを設定します。  スコアは数値が入り、値が大きいほど優先度が高くなります。  また、「inf」は最優先の配置先、「-inf」は配置の禁止を意味します。 #表 8-1 クラスタ設定　…　リソース配置制約 LOCATION_EXPERT score bool_op op role id_spec # スコア and/or 条件 役割 ルールID 備考 200 eq 100 eq -inf or not_defined lt -inf or not_defined eq 共有ディスク故障が発生 したノードでは起動しない ネットワーク故障が発生 したノードでは起動しない ホストsrv01を優先的に Activeにする srv01grpApache #uname #uname srv02 default_ping_set diskcheck_status ERROR rsc attribute value リソースID 条件属性名 条件値 default_ping_set 100 diskcheck_status diskdリソースの属性"diskcheck_status"が存在しない (not_defined)場合、もしく は(or)、値が"ERROR"と等しい(eq)場合、そのノード上でのgrpApacheリソースの起 動を禁止する(スコア = -inf)。 (※ diskdリソース、pingリソースの属性名は各リソース定義時にパラメータで指定します。)
28. リソース同居制約(1/2) Linux-HA Japan Project 28 他のリソースの状態を元にリソースが起動するノードを決めるルールを設定できます。  スコアには「inf」と「-inf」が設定でき、それぞれ以下の挙動になります。  inf : 他のリソースが起動しているノードで対象リソースを起動する。  -inf : 他のリソースが起動しているノードで対象リソースを起動しない。 サーバ#1 サーバ#2 リソースA リソースB サーバ#1 サーバ#2 リソースA リソースB リソース同居制約 if(リソースA == start) リソースB.score = inf リソース同居制約 if(リソースA == start) リソースB.score = -inf リソースB 起動禁止 起動
29. リソース同居制約(2/2) Linux-HA Japan Project 29  リソース同居制約はExcelテンプレートシート 表9-1 に設定します。  以下ではclnPing、 clnDiskdをgrpApacheと同居する様、設定しています。 #表 9-1 クラスタ設定　…　リソース同居制約 COLOCATION # rsc with-rsc score rsc-role with-rsc-role ネットワーク監視・ディスク監視が行われ ているノードで起動する 備考 grpApache clnPing inf 制約関連リソースID 制約対象リソース ID スコア（重み付 け） 制約関連ﾘｿｰｽ の役割 制約対象リソー スの役割 grpApache clnDiskd inf (動作イメージ) サーバ#1 サーバ#2 Disk監視 Network監視 Webサーバ 排他管理 仮想IP Disk監視 Network監視 リソースグループ ディスク監視、ネッ トワーク監視が動 作しているノード上 のみ起動を許可
30. リソース起動順序制約(1/2) Linux-HA Japan Project 30 リソースの起動順序を決めるルールを設定できます。 また、リソースグループの様に停止時に逆順で処理する様に設定することも可能です。  スコアにはinfと0が設定できます。  infの場合も0の場合も起動順は変わりません。  先に処理したリソースのみ状態が変更した際に以下の様に挙動が異なります。 リソースA リソースB リソースC 起動順 停止順 逆順の処理を有効にした場合 リソースA リソースB リソースC 起動順 逆順の処理を無効にした場合 この場合、停止順序 は別途制約で指定す ることも可能です。 リソースAの再起動が必要！ リソースA リソースB リソースA のみ再起動 リソースA リソースB 停止順 起動順 リソースA リソースB 停止順 起動順 リソースA リソースB 停止順 起動順 故障 スコア == 0 スコア == inf
31. リソース起動順序制約(2/2) Linux-HA Japan Project 31  リソース起動順序制約はExcelテンプレートシート 表10-1 に設定します。  以下ではclnPing、 clnDiskd起動後、grpApacheを起動する様、設定しています。 #表 10-1 クラスタ設定　…　リソース起動順序制約 ORDER symmetrical # 起動と逆順 に停止（y/n） 備考 n n 先起動ﾘｿｰｽの アクション 後起動ﾘｿｰｽの アクション first-rsc then-rsc score first-action then-action 先に起動するリソース ID 後に起動するリ ソースID スコア（重み付 け） ネットワーク監視・ディス ク監視起動後に起動する clnPing grpApache 0 clnDiskd grpApache 0 (動作イメージ) Disk監視 Network監視 Webサーバ 排他管理 仮想IP ①監視起動 ②サービス 起動 サーバ#1 Disk監視 Network監視 Webサーバ 排他管理 仮想IP サーバ#1 故障 Disk監視 のみ再起動 起動時 ディスク監視処理の故障時 (ディスク故障ではなく監視処理の故障) 逆順の処理を無効先に起動するリソースの 単独再起動を許可
32. Linux-HA Japan Project 32 Pacemakerのリソース設定 1. リソース定義・パラメータ設定 2. リソース種類選択 3. リソース制約 4. クラスタ設定
33. クラスタ設定(1/3) Linux-HA Japan Project 33 クラスタ設定ではスプリットブレイン時の動作を設定します。  スプリットブレインとは？  スプリットブレインとはネットワーク故障等によってクラスタが分断されることです。 現用機 予備機 故障 現用機からの通信が・・・。 ネットワーク故障？ ノード故障？ どう動けばいいんだ？！ Pacemakerにはスプリットブレインを想定した様々な排他制御が実装されてい ます！詳細は以下をご参照ください。(とっても大切な機能です！) 参照： http://linux-ha.osdn.jp/wp/wp- content/uploads/076783ca53a363270d253bbb98b59e83.pdf スプリットブレインは 対応次第ではシステム 崩壊の危機に！！
34. クラスタ設定(2/3) Linux-HA Japan Project 34 クラスタ設定ではスプリットブレイン対策の排他制御の1つである「接続可能なサーバ数 を参照したリソース制御機能」を設定できます。 故障 抑止 サーバ#1 サーバ#2 サーバ#3 疎通可能なサーバ 疎通可能なサーバ 全サーバ数の内、 過半数と接続可能 リソース起動OK! リソースA リソースB 全サーバ数の内、 過半数と接続不可 リソース起動NG!
35. クラスタ設定(3/3) Linux-HA Japan Project 35  クラスタ設定はExcelテンプレートシート 表2-1 に設定します。  以下では2ノード構成なので先ほどのスプリットブレイン対策は無効(ignore)にし てます。 #表 2-1 クラスタ設定　…　クラスタ・プロパティ PROPERTY # 備考 name value 項目 設定内容 概要 no-quorum-policy ignore ノード数によるリソース割当て 1+1構成の場合は「ignore」を、3台以上の 場合は「freeze」を指定します。 stonith-enabled false 障害ノード対処（STONITH制御） STONITHを使用する場合は「ture」、使用 しない場合は「false」を指定します。 他のスプリットブレイン対策の1つであるSTONITH機能の有 効・無効を設定してます。 STONITH機能については以下を参照ください。 http://linux-ha.osdn.jp/wp/wp- content/uploads/076783ca53a363270d253bbb98b59e83.pdf
36. Linux-HA Japan Project 36 さいごに
37. さいごに 37 Linux-HA Japan URL http://linux-ha.osdn.jp/ Pacemaker関連の最新情報を 日本語で発信 Pacemakerのダウンロードもこ ちらからどうぞ (インストールが楽なリポジトリパッケージ を公開しています) https://ja.osdn.net/projects/linux-ha/ Linux-HA Japan Project
38. さいごに 38 • ML登録用URL http://linux-ha.osdn.jp/ の「メーリングリスト」をクリック • MLアドレス linux-ha-japan@lists.osdn.me 日本におけるHAクラスタについての活発な意見交換の場として 「Linux-HA Japan日本語メーリングリスト」 も開設しています。 Linux-HA-Japan MLでは、Pacemaker、Heartbeat３、Corosync DRBDなど、HAクラスタに関連する話題は歓迎！ ※スパム防止のために、登録者以外の投稿は許可制です Linux-HA Japan Project
39. さいごに 39 本資料の他にも以下の資料を公開しております。 合わせてご参照ください。 Linux-HA Japan Project • Pacemakerインストール方法とCorosync設定 http://linux-ha.osdn.jp/wp/wp- content/uploads/OSC2015_Nagoya.pdf • リソース排他制御 http://linux-ha.osdn.jp/wp/wp- content/uploads/076783ca53a363270d253bbb98b59e83.pdf http://linux-ha.osdn.jp/の『イベント情報』 にて上記を含む活動内容を確認できます。
40. 40 ご清聴ありがとうございました。 Linux-HA Japan 検索 Linux-HA Japan Project
41. Linux-HA Japan Project 41 付録A リソース設定詳細説明
42. 付録A-1. クラスタ・プロパティ設定 Linux-HA Japan Project 42  クラスタの設定をします。  Excelテンプレートシート 表2-1クラスタ・プロパティ  設定内容  no-quorum-policy :  スプリットブレインが発生した際に、孤立したノードの動作を指定します。  基本的には1+1構成なら"ignore"(リソース起動)、3台以上なら"freeze"(何もしない)を指定します。  stonith-enabled :  スプリットブレインが発生した際に、STONITHによる対向ノード強制停止(排他制御)を行うか指定しま す。  STONITHを使用できる環境であれば"true"(使用する)、使用できない環境であれば"false"(使用しな い)を指定します。  "true"を指定するには、表7 にてSTONITHリソースを定義してある必要があります。  startup-fencing :  起動時に状態不明ノードが存在する場合に、STONITHを実行するか指定します。  STONITHを使用する場合には"true"、使用しない場合は"fase"を指定します。  起動時の状態異常はSTONITHではなく、運用者の保守対応が望ましいため、基本的には"false"を 指定します。 #表 2-1 クラスタ設定　…　クラスタ・プロパティ PROPERTY # startup-fencing false 起動時に状態不明ノードへSTONITH 基本的には「false」推奨です。 no-quorum-policy ignore ノード数によるリソース割当て 1+1構成の場合は「ignore」を、N+1構成の 場合は「freeze」を指定します。 stonith-enabled false 障害ノード対処（STONITH制御） STONITHを使用する場合は「ture」、使用 しない場合は「false」を指定します。 備考 name value 項目 設定内容 概要
43. 付録A-2. リソース・デフォルト Linux-HA Japan Project 43  リソースのデフォルト設定をします。  Excelテンプレートシート 表3-1リソース・デフォルト  設定内容  resource-stickiness :  故障復旧時などに自動的にフェイルバックするかを指定します。  基本的には以下のいずれかを設定します。  0 : リソースを最適なノードにフェイルバックする。  INFINITY : 現状起動しているノードで起動状態を継続し、フェイルバックしない。 ※ "INFINITY"を指定した場合でも、故障時のフェイルオーバは行います。  migration-threshold :  何回monitor(監視)処理に失敗した場合にフェイルオーバを実施するかを指定します。  この設定はリソースのオペレーションにmonitorを設定し、且つmonitorの"on-fail"値にrestartを指定 している場合のみ動作に反映されます。  monitor処理に失敗した際に、失敗回数がこの設定値に満たない場合は、同一ノードでリソースを再 起動し、失敗回数がこの設定値以上であればリソースを別ノードへフェイルオーバします。 #表 3-1 クラスタ設定　…　リソース・デフォルト RSC_DEFAULTS # migration-threshold 1 リソース故障可能回数 何回監視に失敗したらフェイルオーバする か設定します。 項目 設定内容 概要 備考 resource-stickiness INFINITY リソース割当て 基本的には「INFINITY」推奨です。 name value
44. 付録A-3. リソース構成 Linux-HA Japan Project 44  リソースの構成を設定します。  Excelテンプレートシート 表4-1リソース構成  設定内容  リソースの種類を選択します。  選択可能な種類は以下の4種類です。  Primitive : プリミティブリソースを定義する。  Group : リソースグループを定義する。  Clone : クローンリソースを定義する。  Master: マスタ/スレーブリソースを定義する。  Primitiveには表7で定義したリソースIDを指定します。  Group、Clone、Masterには任意のユニークなリソースIDを設定し、内包するPrimitiveに表7で定義したリ ソースIDを指定します。  Groupは表4-1で定義した際の内包するPrimitiveの順番が、リソースの起動順序となります(上から順に起 動する)。 #表 4-1 クラスタ設定　…　リソース構成 RESOURCES resourceItem resourceItem resourceItem # 概要 Primitive Group Primitive Primitive Master Primitive Clone Primitive id 備考リソース構成要素 リソースID vip-slave プリミティブ定義 master-group グループ定義 vip-master リソース定義 vip-rep リソース定義 msPostgresql Master/Slave定義 prmPing リソース定義 pgsql リソース定義 clnPing クローン定義
45. 付録A-4. リソース・パラメータ Linux-HA Japan Project 45  リソースのパラメータを設定します。  Excelテンプレートシート 表5-1リソース・パラメータ  設定内容  表7と同様にリソースのパラメータを設定可能です。  表7と異なる点として、プリミティブリソースだけでなくリソースグループやクローンリソース、マスタ/スレーブ リソースに対しての設定が可能です。  基本的にはマスタ/スレーブリソースの以下のパラメータを設定するのに使用します。  master-max :  クラスタ内にマスタリソースを起動する数を指定します。  master-node-max :  1ノード内にマスタリソースを起動する数を指定します。  clone-max :  クラスタ内にマスタ or スレーブリソースを起動する数を指定します。  clone-node-max :  1ノード内にマスタ or スレーブリソースを起動する数を指定します。  notify :  マスタ/スレーブリソースの起動/停止処理の結果を他ノードのリソースへ通知するか否かを設 定します(詳細の動きに関してはRAによって異なります)。  通知する場合は"true"、通史しない場合は"false"を指定します。 #表 5-1 クラスタ設定　…　リソース・パラメータ RSC_ATTRIBUTES type # ﾊﾟﾗﾒｰﾀ種別 meta notify true clone-max 2 clone-node-max 1 id name value リソースID 項目 設定内容 master-node-max 1 備考 msPostgresql master-max 1
46. 付録A-5. STONITHの実行順序 Linux-HA Japan Project 46  STONITHの実行順序を設定します。  Excelテンプレートシート 表6-1STONITHの実行順序  設定内容  STONITH対象のノード名、表7に定義したSTONITHリソースのリソースID、実行順序を設定します。  基本的には各ノード毎にstonith-helperリソースを起動順序"1"として、STONITH実行リソースを起動順序 "2"として定義します。 #表 6-1 クラスタ設定　…　STONITHの実行順序 FENCING_TOPOLOGY # prmStonith2-1 1 prmStonith2-2 2 srv01 実行するSTONITHリソースID 実行順序 備考 prmStonith1-1 1 rsc列には、「STONITH(Primitive)リソースのID」を設定すること prmStonith1-2 2 node STONITHの対象ノード rsc index srv02
47. 付録A-6-1. Primitiveリソース Linux-HA Japan Project 47  リソースを定義します。  Excelテンプレートシート 表7Primitiveリソース  設定内容  任意のユニークなリソースID、使用するRA、各パラメータ、動作を設定します。  RAは以下を設定して指定します。  class : RAの仕様規格を指定します。  provider : /usr/lib/ocf/resource.d/配下にあるRA格納ディレクトリを指定します。  type : RAのファイル名を指定します。  パラメータの設定項目はRAによって異なります。  オペレーションは以下が定義でき、それぞれタイムアウトや監視間隔(monitorのみ)、故障時の動作を設定 できます(故障時の動作については次ページで詳細説明)。  start : リソースを起動する際の動作を設定します。  stop : リソースを停止する際の動作を設定します。  monitor :  リソースを監視する際の動作を設定します。  マスタ/スレーブリソースの場合は、マスタ用とスレーブ用のmonitorを分けて定義する必要があ ります。この場合、新規に"role"の設定列を追加し、マスタ用のmonitorには"Master"を、スレー ブ用のmonitorには"Slave"を設定します。 (以下はマスタ/スレーブリソース限定のオペレーション)  promote : リソースをマスタに昇格する際の動作を設定します。  demote : リソースをスレーブに降格する際の動作を設定します。  notify :  start、stopの実行結果を他ノードに通知する処理の動作を設定します。  このオペレーションは別途表5-1にてnotifyに"ture"を設定する必要があります。
48. 付録A-6-2. Primitiveリソース Linux-HA Japan Project 48  オペレーション故障時の動作設定  オペレーション故障時の動作は各オペレーションのon-failにて設定します。  設定可能な値は以下の通りです。  block : Pacemakerによるリソース管理を停止し、保守者の対応待ちとなります。  fence : 故障発生したノードをクラスタから隔離し、フェイルオーバします(STONITH使用時限定)。  ignore : 故障対応は特に行わず、次の処理へ遷移します。  stop : リソースを停止し、他ノードへのフェイルオーバは行われません。  restart : リソースを再起動します(故障回数によっては他ノードへフェイルオーバされる)。  nothing : restartと同様の処理となります。  基本的にはstart、monitor、promoteのon-failに"restart"を設定します。また、stop、demoteのon-failには、 故障してもサービスに直接影響のないリソースの場合は"ignore"、サービスに影響がありSTONITHを使用 している場合は"fence"、サービスに影響がありSTONITHを使用していない場合は"block"を設定します。 #表 7-1 クラスタ設定　…　Primitiveリソース PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop 概要 prmDiskd id class provider type リソースID class provider type ocf pacemaker diskd name value 項目 設定内容 概要 name diskcheck_status interval 10 options -e device /dev/sda dampen timeout interval on-fail start-delay 2 タイムアウト値 監視間隔 障害時の動作 起動前待機時間 備考 60s 10s restart 60s 0s restart 60s 0s ignore
49. 付録A-7-1. リソース配置制約 Linux-HA Japan Project 49  リソース配置制約を設定します。  Excelテンプレートシート 表8-1リソース配置制約  Pacemakerはリソース起動可能なノードが複数ある場合、より優先度の高いノードでリソースを起動する。  リソース配置制約では属性(Pacemaker内部変数)の値やノード名を元に、対象リソースが起動するノードの 優先度を決定づけるルールを設定できます。  優先度はリソース毎にスコアと条件を指定することで設定でき、指定した条件を満たす場合にスコアの値を 優先度として反映されます。  設定内容  rsc ：  制約の対象となるリソースのリソースIDを設定します。  表4で定義したリソースIDを指定してください。  プリミティブリソースとして使用するリソースのみ、表7で定義したリソースIDを指定します。  score ：  "-INFINITY"～"INFINITY"の数字を指定でき、値が大きいほど優先度が高くなります。また、数字で はなく"-INFINITY"、"INFINITY"を指定した場合は、以下の意味として反映されます。  -INFINITY : 条件が満たされているノードでは対象リソースの起動(もしくは昇格)を禁止する。  INFINITY : 条件が満たされているノードで対象リソースを起動(もしくは昇格) する。  bool_op :  複数の条件のいずれか、もしくは両方が満たされた際に優先度を変更したい場合に"and"もしくは"or" を設定します。  and : 複数の条件を全て満たした場合に優先度を変更する。  or : 複数の条件のいずれかを満たした場合に優先度を変更する。  attribute :  ルールにて参照する情報を設定します。ノード名を参照する場合は"#uname"を、属性の値を参照す る場合は属性名を設定します。
50. 付録A-7-2. リソース配置制約 Linux-HA Japan Project 50  設定内容  op :  attributeとvalueの比較式、もしくはattributeが属性名の場合はattributeの有無を設定します。  eq : attribute = value の場合に適合する。  ne : attribute ≠ value の場合に適合する。  lt : attribute ＜ value の場合に適合する。  gt : attribute ＞ value の場合に適合する。  lte : attribute ≦ value の場合に適合する。  gte : attribute ≧ value の場合に適合する。  defined : attributeが存在する場合に適合する。  not_defined : attributeが存在しない場合に適合する。  value :  opにeq、ne、lt、gt、lte、gteを設定した場合に設定します。  role :  対象リソースのどの処理に対して優先度を設定するかを指定できます。  設定しない場合はリソースの起動に対しての優先度となります。  "master"を設定した場合はリソースの昇格に対して優先度を設定できます(マスタ/スレーブリソース のみ可能)。
51. 付録A-7-3. リソース配置制約 Linux-HA Japan Project 51  よく使用される設定 #表 8-1 クラスタ設定　…　リソース配置制約 LOCATION_EXPERT score bool_op op role id_spec # スコア and/or 条件 役割 ルールID 備考 200 eq 100 eq -inf or not_defined lt -inf or not_defined eq -inf eq -inf eq value 条件値 srv01 #uname srv02 grpPostgreSQL rsc attribute リソースID 条件属性名 #uname srv02grpStonith2 #uname srv01grpStonith1 #uname diskcheck_status ERROR default_ping_set diskcheck_status default_ping_set 100 ① ② ③ ①： リソースに対して、サーバ名に応じた優先度を設定しています。 上記の例では、grpPostgreSQLリソースグループが起動するノードとして、 サーバ名がsrv01のノードの方がsrv02のノードよりも優先度を高く設定 しています。 ②： リソースに対して、属性の値に応じた優先度を設定しています。 上記の例では、 grpPostgreSQLリソースグループに対して、default_ping_set (pingリソースの属性名)が存在しない場合、もしくは値が100未満の場合に、 起動禁止の制約を設定しています。 またdiskcheck_status(diskdリソースの属性名)が存在しない場合、値が ERRORの場合も同様の制約を設定しています。 ③： リソースに対して、特定のノード上では起動しない様に設定しています。 上記の例では、STONITHリソース(grpStonith1、grpStonith2)をSTONITH対象 と同一ノード上で起動しない様に設定しています。
52. 付録A-8-1. リソース同居制約 Linux-HA Japan Project 52  リソース同居制約を設定します。  Excelテンプレートシート 表9-1リソース同居制約  Pacemakerはリソース起動可能なノードが複数ある場合、より優先度の高いノードでリソースを起動する。  リソース同居制約では他リソースの起動有無を元に、対象リソースが起動するノードの優先度を決定づける ルールを設定できます。  優先度はリソース毎にスコアと条件を指定することで設定でき、指定した条件を満たす場合にスコアの値を 優先度として反映されます。  設定内容  rsc ：  優先度を設定する対象リソースのリソースIDを設定します。  表4で定義したリソースIDを指定してください。  プリミティブリソースとして使用するリソースのみ、表7で定義したリソースIDを指定します。  with-rsc ：  起動条件で参照するリソースIDを指定します。  score ：  "-INFINITY"もしくは"INFINITY"を指定できます。  -INFINITY : 条件が満たされているノードでは対象リソースの起動(もしくは昇格)を禁止する。  INFINITY : 条件が満たされているノードで対象リソースを起動(もしくは昇格)する 。  rsc-role :  rscで指定した対象リソースのどの処理に対して優先度を設定するかを指定できます。  設定しない場合はリソースの起動に対しての優先度となります。  マスタ/スレーブリソースの場合は"master"を設定することで、リソースの昇格に対して優先度を設定 できます。
53. 付録A-8-2. リソース同居制約 Linux-HA Japan Project 53  設定内容  with-rsc-role :  条件としてwith-rscで指定したリソースがどの状態の場合に適合するかを指定できます。  設定しない場合はリソースが起動している際に適合します。  "master"を設定した場合、リソースがマスタの場合に適合します(マスタ/スレーブリソースのみ可能)。  よく使用される設定 #表 9-1 クラスタ設定　…　リソース同居制約 COLOCATION # grpPostgres inf with-rsc rsc-role with-rsc-role 制約対象リソースID 制約関連ﾘｿｰｽの役割制約対象リソースの役割 clnDiskd grpPostgres rsc score 制約関連リソースID スコア（重み付け） 備考 clnPing inf ① ①： リソースに対して、他リソースの起動状態に応じた優先度を設定しています。 上記の例では、clnPing(pingリソース)およびclnDiskd(diskdリソース)が起動しているノードで grpPostgresリソースグループが起動を許可しています。
54. 付録A-9-1. リソース起動順序制約 Linux-HA Japan Project 54  リソース起動順序制約を設定します。  Excelテンプレートシート 表10-1リソース起動順序制約  リソースの起動順序を制約で定義します。  設定内容  first-rsc ：  先に処理を実行するリソースのリソースIDを設定します。  表4で定義したリソースIDを指定してください。  プリミティブリソースとして使用するリソースのみ、表7で定義したリソースIDを指定します。  処理内容はfirst-actionで設定します。  then-rsc ：  後に処理を実行するリソースのリソースIDを指定します。  score ：  "INFINITY"もしくは"0"を指定します。どちらを設定した場合も処理順は変わりません。 先に処理したリソースの状態が変更した場合に以下の様に挙動が変わります。  INFINITY : 先に処理したリソースのみ状態変化(リソース停止等)が発生し条件を満たせなく なった場合に、それに合わせて後から処理したリソースにも停止処理を実行する。  0 : 先に処理したリソースに状態変化が発生し条件を満たせなくなった場合でも、後から処理し たリソースは状態を継続する。  first-action :  first-rscで指定した対象リソースの処理を指定できます。  以下の設定が可能であり、設定をしていない場合は"start"が適用されます。  start : リソースを起動する。  stop : リソースを停止する。  promote : リソースを昇格する(マスタ/スレーブリソースのみ)。  demote : リソースを降格する(マスタ/スレーブリソースのみ)。
55. 付録A-9-2. リソース起動順序制約 Linux-HA Japan Project 55  then-action :  first-action 確認後に行う、then-rscで指定した対象リソースの処理を指定できます。  以下の設定が可能であり、設定をしていない場合はfirst-actionと同様の値が適用されます。  start : リソースを起動する。  stop : リソースを停止する。  promote : リソースを昇格する(マスタ/スレーブリソースのみ)。  demote : リソースを降格する(マスタ/スレーブリソースのみ)。  symmetrical :  制約と逆順の制約を設けることができます。  true : 逆順の制約を定義する。  (例) リソースA起動 ⇒ リソースB起動 の制約でsymmetrical=trueの場合： リソースB停止 ⇒ リソースA停止 の制約を定義する。  false : 逆順の制約を定義しない。  よく使用される設定 #表 10-1 クラスタ設定　…　リソース起動順序制約 ORDER symmetrical # 起動と逆順 に停止（y/n） *A 備考 n n first-rsc score 先に起動するリソースID *A スコア（重み 付け） *A then-rsc first-action then-action 後に起動するリ ソースID *A 先起動ﾘｿｰｽの アクション *A 後起動ﾘｿｰｽの アクション *A grpPostgreSQL 0 clnDiskd 0grpPostgreSQL clnPing ① ①： リソースの起動順序を設定しています。 上記の例では、clnPing(pingリソース)およびclnDiskd(diskdリソース)が起動してから grpPostgreSQLリソースグループを起動する様にしています。 尚、grpPostgreSQLリソースグループ内の各プリミティブリソースの起動順序は既に リソースグループ定義時に決定しているため、ここでの制約は不要です。
56. Linux-HA Japan Project 56 付録B リソース設定反映手順
57. 付録B-1. リソース設定反映手順 Linux-HA Japan Project 57  設定反映手順  CSVファイル作成  Excelテンプレートシートを編集し、CSVファイルで保存  [ファイル] > [名前を付けて保存] > ファイルの種類[CSV (カンマ区切り)(*.csv)]  CRMファイル作成  CSVファイルをサーバへ転送し、以下のコマンドを実行  CRMファイルをPacemakerにロード  Pacemakerが起動中且つ、他の設定が反映されていない状態で以下のコマンドを実行 (以下のコマンドはどちらか片系のみで実行)  リソース起動状態を確認  以下のコマンドを実行することで、Pacemakerのリソース状態を確認できます。 # pm_crmgen -o ＜CRMファイル名＞ ＜CSVファイル名＞ # crm configure load update ＜CRMファイル名＞ # crm_mon -fA ここに注意！！！ (詳細は次ページ参照)
58. 付録B-2. リソース設定反映手順 Linux-HA Japan Project 58  既にCRMファイルを読み込ませているPacemakerに追加で読み込ませた場合、設定が 重複して読み込まれ、正常動作しない恐れがあります。  以下のいずれかの手順で以前の設定を削除してから読み込ませてください。  オフライン  オンライン Pacemakerが停止している状態で以下を実行 1. 以下のファイルを削除 【両系でコマンド実行】 # rm /var/lib/pacemaker/cib/* 2. Pacemaker起動 【両系でコマンド実行】 (RHEL 6系) # initctl start pacemaker.combined (RHEL 7系) # systemctl start pacemaker 3. 新しいCRMファイルを反映 【片系でコマンド実行】 # crm configure load update ＜CRMファイル名＞ Pacemakerが起動している状態で以下を実行 1. 起動中にリソースを全て停止 【片系でコマンド実行】 # crm resource stop ＜リソースID＞ 2. 入力済みの設定を削除 【片系でコマンド実行】 # crm configure erase 3. 新しいCRMファイルを反映 【片系でコマンド実行】 # crm configure load update ＜CRMファイル名＞
59. Linux-HA Japan Project 59 付録C 講演で使用したリソース設定紹介
60. 付録C-1.講演のリソース設定 Linux-HA Japan Project 60 # pm_crmgen 環境定義書 ファイル形式バージョン: 2.1 #表 1-1 クラスタ設定　…　クラスタ・ノード属性 NODE ntype # ノード種別 #表 2-1 クラスタ設定　…　クラスタ・プロパティ PROPERTY # #表 3-1 クラスタ設定　…　リソース・デフォルト RSC_DEFAULTS # #表 3-2 クラスタ設定　…　オペレーション・デフォルト OP_DEFAULTS # uname 備考ノード名 ptype name value パラメータ種別 項目 設定内容 name value 項目 設定内容 概要 備考 no-quorum-policy ignore ノード数によるリソース割当て stonith-enabled false 障害ノード対処（STONITH制御） name value 項目 設定内容 概要 備考 resource-stickiness INFINITY リソース割当て migration-threshold 1 リソース故障可能回数 name value 項目 設定内容 概要 備考
61. 付録C-2.講演のリソース設定 Linux-HA Japan Project 61 #表 4-1 クラスタ設定　…　リソース構成 RESOURCES resourceItem resourceItemresourceItem # 概要 Group Primitive prmVIPcheck 仮想IP(VIP)排他制御 Primitive Primitive Clone Primitive Clone Primitive #表 5-1 クラスタ設定　…　リソース・パラメータ RSC_ATTRIBUTES type # ﾊﾟﾗﾒｰﾀ種別 #表 6-1 クラスタ設定　…　STONITHの実行順序 FENCING_TOPOLOGY # clnDiskd クローン定義 id リソース構成要素 リソースID 備考 grpApache グループ定義 prmVIP 仮想IP割当 prmDiskd 内蔵ディスク監視 prmApache Apache制御 clnPing クローン定義 prmPing ネットワーク監視 id name value リソースID 項目 設定内容 備考 node rsc index STONITHの対象ノード 実行するSTONITHリソースID実行順序 備考
62. 付録C-3.講演のリソース設定 Linux-HA Japan Project 62 #表 7-1-1 クラスタ設定　…　Primitiveリソース (id=prmVIPcheck) PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start #表 7-1-2 クラスタ設定　…　Primitiveリソース (id=prmVIP) PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop 60s 0s block 60s 10s restart 60s 0s restart タイムアウト値 監視間隔 on_fail(障害時の動作)起動前待機時間 備考 timeout interval on-fail start-delay name value 項目 設定内容 概要 prmVIP ocf heartbeat IPaddr2 仮想IP割当 リソースID class provider type 概要 タイムアウト値 監視間隔 on_fail(障害時の動作)起動前待機時間 90s 0s restart 6s wait 10 wait値 timeout interval on-fail start-delay target_ip 192.168.146.200 確認するIPアドレス (接続用VIP以外の 同セグメント内の範囲で適当なVIP) count 1 実行回数 name value 項目 設定内容 概要 id class provider type リソースID class provider type 概要 prmVIPcheck ocf heartbeat VIPcheck 仮想IP(VIP)排他制御 備考 id class provider type ip 192.168.146.200 Apache接続用仮想IPアドレス nic eno33554984 同デバイス名 cidr_netmask 28 同ネットマスク
63. 付録C-4.講演のリソース設定 Linux-HA Japan Project 63 #表 7-1-3 クラスタ設定　…　Primitiveリソース (id=prmApache) PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop #表 7-2-1 クラスタ設定　…　Primitiveリソース (id=prmPing) PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop 60s 10s restart 60s 0s restart 概要 debug name default_ping_set host_list 192.168.146.1 監視するネットワークのIPアドレス multiplier 100 属性値 attempts 2 リトライ回数 timeout 2 タイムアウト true ping先故障検知時のログ出力 60s 10s restart 60s 0s block タイムアウト値 60s 0s restart configfile /etc/httpd/conf/httpd.conf Apache設定ファイル timeout name value 項目 設定内容 概要 id class provider type リソースID class provider type 概要 prmApache ocf heartbeat apache ldirectord監視 prmPing ocf pacemaker ping interval on-fail start-delay 監視間隔 on_fail(障害時の動作)起動前待機時間 備考 id class provider type リソースID class 60s 0s ignore provider type 概要 ネットワーク監視 name value 項目 設定内容 ネットワーク監視用の属性名 タイムアウト値 監視間隔 on_fail(障害時の動作)起動前待機時間 備考 timeout interval on-fail start-delay
64. 付録C-5.講演のリソース設定 Linux-HA Japan Project 64 #表 7-3-1 クラスタ設定　…　Primitiveリソース (id=prmDiskd) PRIMITIVE P # A type # パラメータ種別 params O type # オペレーション start monitor stop #表 8-1 クラスタ設定　…　リソース配置制約 LOCATION_EXPERT score bool_op op role id_spec # スコア and/or 条件 役割 ルールID 備考 200 eq 100 eq -inf or not_defined lt -inf or not_defined eq 概要 prmDiskd ocf pacemaker diskd 内蔵ディスク監視 id class provider type リソースID class provider type name value 項目 設定内容 概要 options interval -e 監視オプション(スレッドタイマ→有効) name diskcheck_status_internal 内蔵ディスク用の属性名 device /dev/sda 【内蔵ディスクパーティション名】 監視する内蔵ディスクのパーティション番号 を除いたディスクパーティション名 dampen timeout interval on-fail start-delay 10 監視間隔 2 属性更新待ち時間 60s 0s restart タイムアウト値 監視間隔 on_fail(障害時の動作)起動前待機時間 備考 60s 0s ignore 60s 10s restart rsc attribute value リソースID 条件属性名 条件値 ホストsrv01を 優先的に Activeにする#uname srv02 default_ping_set ネットワーク 故障が発生し たノードでは 起動しない default_ping_set 100 grpApache #uname srv01 diskcheck_status_internal 内蔵ディスク 故障が発生し たノードでは 起動しない diskcheck_status_internal ERROR
65. 付録C-6.講演のリソース設定 Linux-HA Japan Project 65 #表 9-1 クラスタ設定　…　リソース同居制約 COLOCATION # #表 10-1 クラスタ設定　…　リソース起動順序制約 ORDER symmetrical # 起動と逆順に停止（y/n）備考 n n #表 11-1 クラスタ設定　…　リソースチケット制約 RSC_TICKET # #表 12-1 クラスタ設定　…　追加設定 ADDITIONAL_CONFIG # infclnDiskdgrpApache grpApache clnPing inf 制約関連リソースID 制約対象リソースIDスコア（重み付け）制約関連ﾘｿｰｽの役割制約対象リソースの役割 rsc with-rsc score rsc-role with-rsc-role config 追加設定 (記述内容がそのまま出力されます) 備考 clnDiskd grpApache 0 備考 チケット付与時に起動するリソースID役割 ﾁｹｯﾄ剥奪時のアクション備考 ticket rsc role loss-policy チケットID first-rsc then-rsc score first-action 先に起動するリソースID 後に起動するリソースIDスコア（重み付け）先起動ﾘｿｰｽのアクション clnPing grpApache 0 then-action 後起動ﾘｿｰｽのアクション
```
