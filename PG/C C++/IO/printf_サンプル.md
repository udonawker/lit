[若葉プログラミング塾 > 知識の玉手箱 > C関数リファレンス > fprintf](https://www.k-cube.co.jp/wakaba/server/func/fprintf.html)

<pre>
fprintf() は、 printf() の一般的なもので、 出力ストリームに文字列をフォーマットに従って出力する機能を持つが、これは例えば puts() などと違う。

変換指定子の定義は、上を読んでもらえれば余すところなく書いてあるはずであるが、なかなか読む気も起こるまい。 こちらにフォーマット指定子をまとめたページがあるので、参照されたい。 ここではいくつかサンプルをお見せしようと思う。コメントの内部は Mingw GCC での出力結果である。

#include <stdio.h>

void main(){
	int i;
	printf("%d\n", 200);   /* 200  */
	printf("%i\n", 200);   /* 200  */
	printf("% d\n", 200);  /*  200 */
	printf("% d\n", -200); /* -200 */
	printf("%+d\n", 200);  /* +200 */
	printf("%+d\n", -200); /* -200 */
	printf("%o\n", 200);   /* 310  */
	printf("%#o\n", 200);  /* 0310 */
	printf("%x", 200);     /* c8   */
	printf("%#x", 200);    /* 0xc8 */
	printf("%#X\n", 200);  /* 0XC8 */
	printf("%f\n", 123.456);               /* 123.456000        */
	printf("%10.2f\n", 123.456);           /*     123.46        */
	printf("%010.2f\n", 123.456);          /* 0000123.46        */
	printf("%e\n", 123.456);               /* 1.234500e+02      */
	printf("%E\n", 123.456);               /* 1.234500E+02      */
	printf("%10.3e\n", 123.456);           /* 1.235e+02         */
	printf("%g\n", 123.456);               /* 123.456           */
	printf("%g\n", 0.0000123456);          /* 1.23456e-05       */
	printf("[%c]\n", 'h');                 /* [h]               */
	printf("[%*c]\n", 5, 'h');             /* [    h]           */
	printf("This is a %s.\n", "string");   /* This is a string. */
	printf("[%s]\n", "overlength");        /* [overlength]      */
	printf("[%*s]\n", 5, "overlength");    /* [overlength]      */
	printf("[%.*s]\n", 5, "overlength");   /* [overl]           */
	printf("Address: %p\n", main);         /* Address: 00401330 */
	printf("this many of chars are written so far:%n", &i);
	printf("%d\n", i); /* this many of chars are written so far:38 */
}
最後の2つに注意していただきたいのだが、 p 変換では、何文字出力されるか、どんな表現方法かなどといった事は完全に処理系定義であるから、 ここの結果を信用しないでいただきたい。また、 n 変換では

	printf("this many of chars are written so far:%n%d\n", &i, i);
というような書き方をしてしまうと、でたらめな出力になるだろう。 i の値は関数呼び出し時のもののコピーであり、関数内部で i の値が変更されたとしても、コピーのほうには反映されないからである。 よしんば反映されたとしても、変更される順番は未定義なので、最初の例のような結果が得られるかどうかは処理系によることになる。

フラグ(flag:旗)というのはコンピュータ用語で、オン・オフ二つの状態を取りうる変数のことを呼ぶ。 この場合のフラグは、それに対応する文字 "#0 -+" を書くか書かないかでオン・オフが決まる。

この関数は可変長引数関数 (Variable argument) と呼ばれる特殊な関数である。 この種の関数は宣言の引数リストの最後に「...」がついているもので、ここから後はどんな型のいくつの変数であろうと渡すことができる。 しかし、渡される側はどんな型のいくつの変数が渡されたかを直接知る手段はない。関数は format に渡される文字列を元に、これらの引数の数と型を知る。 よって、 format の文字列と実引数リストが食い違っていてはいけない。

変数のサイズを指定する h 、 l 、 L については若干の注意が必要である。 %hd は short int 、 %d は int 、 %ld は long int の引数に対応し、 %f は float 、 %lf は double 、 %Lf は long double に対応しているのだが、可変長の引数には標準変換がなされ、 int より短い整数は int に、 double より短い浮動小数点数は double に暗黙のうちに変換されるため、 %hd と %d 、 %f と %lf は同じ意味になってしまう。 これは fscanf() の仕様と非対称である。 標準変換については va_arg マクロの解説を参照されたい。

可変長引数関数については、 <stdarg.h> を参照されたい。
</pre>
